<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: #fff;
    overflow: hidden; /* üö´ Evita que la p√°gina se mueva */
    height: 100vh;
  }

  /* ===== MENU ===== */
  nav.menu-desplegable {
    background-color: rgba(44, 62, 80, 0.9);
    padding: 0.7em 1em;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  }
  .dropdown { position: relative; }
  .dropbtn {
    background: none;
    color: #ecf0f1;
    padding: 10px 18px;
    font-size: 1.1rem;
    font-weight: 600;
    border: 2px solid transparent;
    cursor: pointer;
    border-radius: 10px;
    transition: background-color 0.3s, transform 0.2s;
  }
  .dropbtn:hover {
    background-color: #1c80c8;
    transform: scale(1.05);
  }
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: rgba(52, 73, 94, 0.95);
    min-width: 200px;
    margin-top: 8px;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  }
  .dropdown-content a {
    color: #ecf0f1;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    transition: background 0.3s;
  }
  .dropdown-content a:hover {
    background-color: #1c80c8;
  }
  .dropdown:hover .dropdown-content { display: block; }

  header {
    text-align: center;
    padding: 1em;
    font-size: 2rem;
    font-weight: 700;
    color: #e0e0e0;
  }

  /* ===== CONTENEDOR PRINCIPAL ===== */
  .container {
    position: relative;
    z-index: 10;
    max-width: 1100px;
    margin: auto;
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(15px);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
    height: calc(100vh - 180px); /* Altura ajustada */
    display: flex;
    flex-direction: column;
  }

  /* ===== CONTENEDOR DE TABLA CON SCROLL ===== */
  .table-container {
    flex: 1;
    overflow-y: auto; /* ‚úÖ solo la tabla se mueve */
    scrollbar-width: thin;
    scrollbar-color: #1c80c8 #2c3e50;
  }
  .table-container::-webkit-scrollbar {
    width: 8px;
  }
  .table-container::-webkit-scrollbar-thumb {
    background-color: #1c80c8;
    border-radius: 8px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    color: #fff;
  }
  th, td {
    padding: 14px 16px;
    text-align: left;
  }
  th {
    background: rgba(28, 128, 200, 0.8);
    text-transform: uppercase;
    font-weight: 600;
    font-size: 0.95rem;
    position: sticky;
    top: 0; /* üß∑ Encabezado fijo */
    z-index: 5;
  }
  tr {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: background 0.3s;
  }
  tr:hover {
    background: rgba(255, 255, 255, 0.08);
  }

  /* ===== SWITCH ===== */
  .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 26px;
  }
  .switch input { display: none; }
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #e74c3c;
    transition: .4s;
    border-radius: 26px;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 20px; width: 20px;
    left: 3px; bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  input:checked + .slider { background-color: #2ecc71; }
  input:checked + .slider:before { transform: translateX(24px); }

  /* ===== FONDO ANIMADO ===== */
  #backgroundCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
  }
</style>
</head>
<body>

<nav class="menu-desplegable">
    <div class="dropdown">
      <button class="dropbtn">‚ò∞ Men√∫</button>
      <div class="dropdown-content">
        <a href="Inventario.html">Inventario</a>
        <a href="Clientes.html">Clientes</a>
        <a href="Productos.html">Productos</a>
        <a href="Top_Ventas.html">M√°s vendidos</a>
        <a href="Ventas.html">Ventas</a>
        <a href="Registrar_Entrada.html">Registrar Entrada nuevo producto</a>
        <a href="Proveedores.html">Proveedores</a>
        <a href="historial.html">Historial</a>
        <a href="Salidas.html">Salidas</a>
        <a href="Movimientos.html">Movimientos</a>
        <a href="Pagos.html">Pagos</a>
        <a href="Login.html" id="logoutLink">Cerrar sesi√≥n</a>
      </div>
    </div>
  </nav>

<header>Inventario</header>

<div class="container">
  <div class="table-container">
    <table id="inventarioTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Producto</th>
          <th>Almac√©n</th>
          <th>Lote</th>
          <th>Fecha Ingreso</th>
          <th>Cantidad</th>
          <th>En Venta</th>
        </tr>
      </thead>
      <tbody>
        <!-- Datos cargados con JS -->
      </tbody>
    </table>
  </div>
</div>

<canvas id="backgroundCanvas"></canvas>

<script>
const jefeId = localStorage.getItem('jefe_id');
const tableBody = document.querySelector('#inventarioTable tbody');

fetch(`http://localhost:3000/inventario/${jefeId}`)
  .then(res => res.json())
  .then(data => {
    tableBody.innerHTML = '';
    data.forEach(item => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.id}</td>
        <td>${item.producto}</td>
        <td>${item.almacen}</td>
        <td>${item.lote || ''}</td>
        <td>${item.fecha_ingreso || ''}</td>
        <td>${item.cantidad}</td>
        <td>
          <label class="switch">
            <input type="checkbox" ${item.en_venta ? 'checked' : ''} data-id="${item.id}">
            <span class="slider"></span>
          </label>
        </td>
      `;
      const checkbox = tr.querySelector('input[type="checkbox"]');
      checkbox.addEventListener('change', () => {
        const estado = checkbox.checked;
        const idInventario = checkbox.dataset.id;
        fetch(`http://localhost:3000/inventario/${idInventario}/venta`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ en_venta: estado })
        })
        .then(r => r.json())
        .then(resp => console.log('‚úÖ Actualizado:', resp))
        .catch(err => console.error('‚ùå Error:', err));
      });
      tableBody.appendChild(tr);
    });
  })
  .catch(err => {
    console.error('Error al cargar inventario:', err);
    tableBody.innerHTML = '<tr><td colspan="7">Error al cargar inventario</td></tr>';
  });

  document.getElementById('logoutLink').addEventListener('click', async (e) => {
    e.preventDefault();
      try {
        const res = await fetch('http://localhost:3000/generar-respaldo', { method: 'POST' });
        if (!res.ok) throw new Error('Fallo en la generaci√≥n del respaldo');
        console.log("‚úÖ Respaldo generado correctamente");
      } catch (err) {
        console.error('‚ùå Error al generar respaldo:', err);
        alert("No se pudo generar el respaldo. Cierre de sesi√≥n de todas formas.");
      }

      localStorage.removeItem('jefe_id');
      localStorage.removeItem('usuario');
      window.location.href = 'Login.html';
    });
/* ==== FONDO ANIMADO ==== */
const canvas = document.getElementById('backgroundCanvas');
const ctx = canvas.getContext('2d');
let width, height;
function resize() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; }
window.addEventListener('resize', resize);
resize();

class Shape {
  constructor() { this.reset(); }
  reset() {
    this.x = Math.random() * width;
    this.y = Math.random() * height;
    this.size = 50 + Math.random() * 80;
    this.speedX = (Math.random() * 0.3 + 0.05) * (Math.random() < 0.5 ? 1 : -1);
    this.speedY = (Math.random() * 0.2 + 0.03) * (Math.random() < 0.5 ? 1 : -1);
    this.opacity = 0.05 + Math.random() * 0.15;
    this.color = `rgba(255, 255, 255, ${this.opacity})`;
    this.type = Math.floor(Math.random() * 3);
    this.rotation = Math.random() * 2 * Math.PI;
    this.rotationSpeed = (Math.random() - 0.5) * 0.002;
  }
  draw(ctx) {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation);
    ctx.fillStyle = this.color;
    switch (this.type) {
      case 0:
        ctx.beginPath();
        ctx.arc(0, 0, this.size / 2, 0, Math.PI * 2);
        ctx.fill();
        break;
      case 1:
        ctx.beginPath();
        ctx.moveTo(0, -this.size / 1.5);
        ctx.lineTo(this.size / 1.3, this.size / 2);
        ctx.lineTo(-this.size / 1.3, this.size / 2);
        ctx.closePath();
        ctx.fill();
        break;
      case 2:
        const r = this.size / 5;
        ctx.beginPath();
        ctx.moveTo(-this.size / 2 + r, -this.size / 2);
        ctx.lineTo(this.size / 2 - r, -this.size / 2);
        ctx.quadraticCurveTo(this.size / 2, -this.size / 2, this.size / 2, -this.size / 2 + r);
        ctx.lineTo(this.size / 2, this.size / 2 - r);
        ctx.quadraticCurveTo(this.size / 2, this.size / 2, this.size / 2 - r, this.size / 2);
        ctx.lineTo(-this.size / 2 + r, this.size / 2);
        ctx.quadraticCurveTo(-this.size / 2, this.size / 2, -this.size / 2, this.size / 2 - r);
        ctx.lineTo(-this.size / 2, -this.size / 2 + r);
        ctx.quadraticCurveTo(-this.size / 2, -this.size / 2, -this.size / 2 + r, -this.size / 2);
        ctx.closePath();
        ctx.fill();
        break;
    }
    ctx.restore();
  }
  update() {
    this.x += this.speedX;
    this.y += this.speedY;
    this.rotation += this.rotationSpeed;
    if (this.x > width + this.size) this.x = -this.size;
    else if (this.x < -this.size) this.x = width + this.size;
    if (this.y > height + this.size) this.y = -this.size;
    else if (this.y < -this.size) this.y = height + this.size;
  }
}
const shapes = [];
for (let i = 0; i < 35; i++) shapes.push(new Shape());
function animate() {
  ctx.clearRect(0, 0, width, height);
  for (let s of shapes) { s.update(); s.draw(ctx); }
  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
